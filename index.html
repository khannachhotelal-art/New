<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Universal AI Chat</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Marked.js (Markdown parsing ke liye) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- DOMPurify (Security ke liye) -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { gray: { 950: '#030712' } } } }
    }
  </script>

  <style>
    .markdown-body h1, .markdown-body h2 { font-weight: 600; margin-top: 1em; }
    .markdown-body pre { background: #f6f8fa; padding: 16px; border-radius: 8px; overflow-x: auto; }
    .dark .markdown-body pre { background: #161b22; }
    .typing-cursor::after { content: '▋'; animation: blink 1s step-start infinite; }
    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body class="flex min-h-[100dvh] bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">

  <!-- Loading Screen -->
  <div id="loading" class="fixed inset-0 z-[100] flex items-center justify-center bg-white dark:bg-gray-900">
    <div class="text-xl font-medium animate-pulse">Loading App...</div>
  </div>

  <!-- Sidebar Overlay -->
  <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 bg-gray-50 dark:bg-gray-950 border-r border-gray-200 dark:border-gray-800 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 flex flex-col">
    <div class="p-4 flex items-center justify-between">
      <h1 class="text-xl font-semibold">Universal AI</h1>
      <button id="close-sidebar-btn" class="md:hidden p-2">✕</button>
    </div>
    <div class="px-4 pb-4">
      <button id="new-chat-btn" class="w-full bg-blue-600 text-white py-2.5 rounded-lg font-medium">+ New Chat</button>
    </div>
    <div class="flex-1 overflow-y-auto px-2" id="chat-list"></div>
    <div class="p-4 border-t border-gray-200 dark:border-gray-800">
      <button id="settings-btn" class="w-full text-left p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">Settings</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 flex flex-col min-w-0">
    <!-- Header -->
    <header class="h-14 flex items-center px-4 border-b md:hidden sticky top-0 bg-white dark:bg-gray-900 z-20">
      <button id="open-sidebar-btn" class="p-2 mr-2">☰</button>
      <h2 id="mobile-header-title" class="font-medium truncate">New Chat</h2>
    </header>

    <!-- Messages -->
    <div id="messages-area" class="flex-1 px-4 py-6 max-w-4xl mx-auto w-full flex flex-col space-y-6 pb-32">
      <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-center">
        <h2 class="text-2xl font-semibold">How can I help you?</h2>
      </div>
    </div>
    
    <!-- Input -->
    <div class="sticky bottom-0 bg-white dark:bg-gray-900 border-t p-4 w-full">
      <div class="max-w-4xl mx-auto">
        <form id="message-form" class="relative flex items-end bg-white dark:bg-gray-800 border rounded-2xl p-2">
          <textarea id="message-input" rows="1" class="w-full p-2 bg-transparent border-none outline-none resize-none" placeholder="Message AI..."></textarea>
          <button type="submit" id="send-btn" class="bg-blue-600 text-white p-2 rounded-xl">Send</button>
        </form>
      </div>
    </div>
  </main>

  <!-- Settings Modal (Hidden by default) -->
  <div id="settings-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 hidden">
    <div class="bg-white dark:bg-gray-900 p-6 rounded-xl w-full max-w-md shadow-2xl">
      <h3 class="text-lg font-semibold mb-4">Settings</h3>
      <input type="password" id="setting-api-key" class="w-full p-2 mb-4 border rounded bg-transparent" placeholder="OpenRouter API Key" />
      <input type="text" id="setting-model" class="w-full p-2 mb-4 border rounded bg-transparent" placeholder="Model (e.g. deepseek/deepseek-r1:free)" />
      <div class="flex justify-end gap-2">
        <button id="close-settings-btn" class="px-4 py-2">Cancel</button>
        <button id="save-settings-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      let chats = JSON.parse(localStorage.getItem('chats') || '[]');
      let settings = JSON.parse(localStorage.getItem('settings') || '{"apiKey":"","model":"deepseek/deepseek-r1:free"}');
      let currentChatId = null;
      let isGenerating = false;

      const els = {
        messageForm: document.getElementById('message-form'),
        messageInput: document.getElementById('message-input'),
        messagesArea: document.getElementById('messages-area'),
        chatList: document.getElementById('chat-list'),
        settingsModal: document.getElementById('settings-modal')
      };

      // UI Logic
      function renderMessages() {
        const chat = chats.find(c => c.id === currentChatId);
        els.messagesArea.innerHTML = chat ? '' : '<div class="text-center mt-20">Start a new conversation</div>';
        if (chat) {
          chat.messages.forEach(msg => {
            const div = document.createElement('div');
            div.className = msg.role === 'user' ? 'text-right' : 'text-left';
            div.innerHTML = `<div class="inline-block p-3 rounded-lg ${msg.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-800'}">${msg.content}</div>`;
            els.messagesArea.appendChild(div);
          });
        }
      }

      els.messageForm.onsubmit = async (e) => {
        e.preventDefault();
        const content = els.messageInput.value.trim();
        if (!content || !settings.apiKey) return alert("Please check API Key");

        if (!currentChatId) {
          currentChatId = Date.now().toString();
          chats.push({ id: currentChatId, title: content.slice(0, 20), messages: [] });
        }
        
        const chat = chats.find(c => c.id === currentChatId);
        chat.messages.push({ role: 'user', content });
        els.messageInput.value = '';
        renderMessages();

        // API Call (Simplified)
        try {
          const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${settings.apiKey}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ model: settings.model, messages: chat.messages })
          });
          const data = await res.json();
          chat.messages.push({ role: 'assistant', content: data.choices[0].message.content });
          localStorage.setItem('chats', JSON.stringify(chats));
          renderMessages();
        } catch (err) { alert("Error calling API"); }
      };

      document.getElementById('settings-btn').onclick = () => els.settingsModal.classList.remove('hidden');
      document.getElementById('save-settings-btn').onclick = () => {
        settings.apiKey = document.getElementById('setting-api-key').value;
        settings.model = document.getElementById('setting-model').value;
        localStorage.setItem('settings', JSON.stringify(settings));
        els.settingsModal.classList.add('hidden');
      };
      document.getElementById('close-settings-btn').onclick = () => els.settingsModal.classList.add('hidden');
      document.getElementById('loading').style.display = 'none';
    })();
  </script>
</body>
</html>
